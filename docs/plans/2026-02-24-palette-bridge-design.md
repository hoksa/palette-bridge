# Palette Bridge: Tailwind to Material Design 3 Color Mapping Tool

## Problem

We have an established brand color system (3 accent palettes + neutral, 11 Tailwind shades each) used on web. Our Android tablet app uses Material Design 3, but its theme was generated by Material Theme Builder's HCT algorithm, producing colors that drift from our brand palette. We want to eliminate HCT entirely and directly map our Tailwind palette shades to M3 color roles.

## Goals

1. Every M3 color role maps to a specific Tailwind palette shade — no algorithmically generated colors for accent roles.
2. A visual, interactive web tool for defining and verifying the mapping.
3. Identical hex values across web and tablet for equivalent purposes.
4. Export to Kotlin (Color.kt + Theme.kt), Material Theme Builder JSON, Tokens Studio JSON, and CSS custom properties.

## Constraints

- No HCT algorithm. Hex values go in, same hex values come out.
- Tailwind palette is the source of truth.
- Must remain compatible with standard M3 Compose components (replacing values inside `ColorScheme`, not the architecture).
- Accessibility is informed, not enforced: contrast ratios are surfaced clearly for intentional trade-offs.

## Decisions Made

| Decision | Choice |
|----------|--------|
| Tech stack | React + Vite + Tailwind CSS + TypeScript |
| Architecture | Approach A: Static Mapping Table (table-based UI with dropdowns) |
| Export priority | Kotlin and Figma exports both needed from MVP |
| Palette input | User provides hex + OKLCH values for 4 palettes (primary, secondary, tertiary, error) + neutral |
| Surface neutrals | Build both modes: "strict palette only" and "OKLCH interpolated intermediates" — user decides visually |
| Contrast variants | Support all three levels (standard, medium, high) |
| Contrast logic | Independent of HCT — uses M3's tone-shift lookup table, auto-generates recommendations from standard mapping |
| Extended colors | Standard M3 roles only |
| Error palette | Treated as a fourth accent palette (same 11-shade structure) |

## Data Model

### Palette Configuration (input)

```typescript
interface PaletteConfig {
  palettes: {
    [name: string]: {  // "primary", "secondary", "tertiary", "error", "neutral"
      shades: {
        [shade: string]: {  // "50", "100", ..., "950"
          hex: string;
          oklch?: string;
        };
      };
    };
  };
  interpolated?: {
    [name: string]: {
      hex: string;
      oklch: string;
      source: { between: [string, string]; position: number };
    };
  };
}
```

### Theme Mapping (user-editable output)

```typescript
interface ThemeMapping {
  light: RoleAssignments;
  dark: RoleAssignments;
  mediumContrast: { light: RoleAssignments; dark: RoleAssignments };
  highContrast: { light: RoleAssignments; dark: RoleAssignments };
}

interface ShadeRef {
  palette: string;  // "primary", "neutral", etc.
  shade: string;    // "600", "interpolated-87", etc.
}
```

`RoleAssignments` maps all ~35 M3 color roles (primary, onPrimary, primaryContainer, onPrimaryContainer, secondary, ..., surface, surfaceDim, surfaceBright, surfaceContainerLowest through surfaceContainerHighest, outline, outlineVariant, scrim, shadow, etc.) to `ShadeRef` values.

Every assignment is a pointer into the palette — never a raw hex value.

### Default Mapping (tone-to-shade correspondence)

| M3 Tone | Tailwind Shade |
|---------|---------------|
| 0 | black / 950 |
| 10 | 900 |
| 20 | 800 |
| 30 | 700 |
| 40 | 600 |
| 50 | 500 |
| 60 | 400 |
| 70 | 300 |
| 80 | 200 |
| 90 | 100 |
| 95 | 50 |
| 100 | white |

## Contrast Variant Logic

M3's contrast system is independent of HCT. It uses `ContrastCurve(low, normal, medium, high)` values that specify target contrast ratios for each role, then resolves the tone needed to achieve that ratio.

Key findings from M3 source code:

- **Accent roles** (primary, secondary, tertiary, error): at medium contrast, primary shifts from tone 40→~30 (light) / 80→~85 (dark). At high contrast, similar shifts with more extreme on-role tones.
- **Surface containers**: have direct tone values at each contrast level (deterministic, no contrast-ratio calculation).
- **on-roles**: pushed toward extremes (0 or 100) at higher contrast levels.

The tool auto-generates medium and high contrast mappings by applying these tone shifts to the standard mapping, then mapping each shifted tone to the nearest Tailwind shade. All auto-generated assignments are individually overridable.

### Accent Role Tone Shifts (Light Theme)

| Role | Standard | Medium | High |
|------|----------|--------|------|
| X (primary/secondary/...) | 40 → 600 | ~30 → 700 | ~30 → 700 |
| onX | 100 → white | 100 → white | 100 → white |
| XContainer | 90 → 100 | ~85 → 200 | ~80 → 200 |
| onXContainer | 30 → 700 | ~25 → 800 | ~17 → 900 |

### Accent Role Tone Shifts (Dark Theme)

| Role | Standard | Medium | High |
|------|----------|--------|------|
| X | 80 → 200 | ~85 → 100 | ~85 → 100 |
| onX | 20 → 800 | ~15 → 900 | 0 → 950 |
| XContainer | 30 → 700 | ~35 → 700 | ~40 → 600 |
| onXContainer | 90 → 100 | ~93 → 50 | ~97 → 50 |

### Surface Container Tones (Direct Values)

| Role | Light (std/med/high) | Dark (std/med/high) |
|------|---------------------|---------------------|
| surfaceDim | 87/80/75 | 6 (fixed) |
| surfaceBright | 98 (fixed) | 24/29/34 |
| surfaceContainerLowest | 100 (fixed) | 4/2/0 |
| surfaceContainerLow | 96/96/95 | 10/11/12 |
| surfaceContainer | 94/92/90 | 12/16/20 |
| surfaceContainerHigh | 92/88/85 | 17/21/25 |
| surfaceContainerHighest | 90/84/80 | 22/26/30 |

## UI Layout

### Panel 1: Palette Editor (top/sidebar)

- Horizontal swatch strips for each palette (primary, secondary, tertiary, error, neutral)
- 11 shades per strip with hex labels
- Toggle to show/hide interpolated neutral shades
- "Generate intermediate neutrals" button for OKLCH interpolation
- Editable palette values (paste hex or OKLCH)

### Panel 2: Mapping Table (main content)

- Rows: all M3 color roles, grouped by family
- Columns: role name, light assignment (swatch + label), dark assignment, light contrast ratio, dark contrast ratio
- Click assignment cell → popup palette picker showing relevant palette strip
- Contrast ratios with pass/warn/fail indicators (green >= 4.5, yellow >= 3, red < 3)
- Tabs: Standard | Medium Contrast | High Contrast
- "Reset to defaults" per contrast level

### Panel 3: Theme Preview (right/below)

- Mini M3 component gallery: filled/outlined/tonal/text buttons, card, FAB, surface layers, text samples
- Light/dark toggle or side-by-side mode
- Renders with current mapping in real time

### Panel 4: Export

- Export Kotlin (Color.kt + Theme.kt)
- Export Material Theme Builder JSON
- Export Tokens Studio JSON (for Figma)
- Export CSS Custom Properties
- Import/Export Mapping JSON (for save/load/version control)

## OKLCH Interpolation for Neutrals

When "allow interpolated neutrals" is enabled:

1. Tool identifies gaps where M3 needs tones between existing Tailwind shades.
2. Generates intermediate values via OKLCH interpolation between bounding shades.
3. Interpolated shades are visually distinct (dashed border, "interpolated" label).
4. Included in exports with clear naming (e.g., `gray_075`).
5. User can accept or reject individual interpolated values.

## Technical Architecture

```
src/
  components/
    PaletteEditor.tsx        — Palette swatch strips with edit capability
    MappingTable.tsx          — Role-to-shade assignment table
    ShadeSelector.tsx         — Popup palette picker
    ContrastBadge.tsx         — Contrast ratio indicator
    ThemePreview.tsx          — Mock M3 component gallery
    ExportPanel.tsx           — Export buttons and format selection
  data/
    m3-roles.ts              — Complete list of M3 color roles with metadata
    default-mapping.ts       — Default tone-to-shade mapping table
    contrast-shifts.ts       — Medium/high contrast tone shift lookup
  lib/
    contrast.ts              — WCAG contrast ratio calculation
    oklch.ts                 — OKLCH interpolation for neutral generation
    export-kotlin.ts         — Kotlin Color.kt + Theme.kt generator
    export-material-json.ts  — Material Theme Builder JSON format
    export-tokens-studio.ts  — Tokens Studio JSON format
    export-css.ts            — CSS custom properties generator
  hooks/
    useThemeMapping.ts       — State management (useReducer + localStorage)
  types/
    index.ts                 — TypeScript interfaces
  App.tsx
  main.tsx
```

State management: React `useReducer` + `localStorage` persistence. No external state library needed.

## Export Format Details

### Kotlin (Color.kt)

Matches Material Theme Builder's output structure:

```kotlin
val primary = Color(0xFF3B82F6)      // brand primary-500
val onPrimary = Color(0xFFFFFFFF)    // white
val primaryContainer = Color(0xFFDBEAFE)  // brand primary-100
// ... all roles
```

### Material Theme Builder JSON

Matches the JSON format that Android Studio and Material Theme Builder understand, ensuring compatibility with existing Android tooling.

### Tokens Studio JSON

Compatible with the Tokens Studio Figma plugin for batch-importing color tokens into Figma files.

### CSS Custom Properties

```css
:root {
  --md-sys-color-primary: #3b82f6;
  --md-sys-color-on-primary: #ffffff;
  /* ... */
}
```
